# SPEC: –°–∏—Å—Ç–µ–º–∞ –∏–º—ë–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–í–µ—Ä—Å–∏—è:** 1.1
**–î–∞—Ç–∞:** 2026-02-23
**–°—Ç–∞—Ç—É—Å:** Draft

---

## 1. –¶–µ–ª—å (Goal)

–°–µ–π—á–∞—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è 8-—Å–∏–º–≤–æ–ª—å–Ω—ã–º –∞–Ω–æ–Ω–∏–º–Ω—ã–º ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, `A3BX9K2M`). –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ SOS-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫—Ç–æ –∏–º–µ–Ω–Ω–æ –∑–∞ —ç—Ç–∏–º ID —Å—Ç–æ–∏—Ç.

–¶–µ–ª—å ‚Äî –ø–æ–∑–≤–æ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞–¥–∞–≤–∞—Ç—å —á–∏—Ç–∞–µ–º–æ–µ –∏–º—è, –∫–æ—Ç–æ—Ä–æ–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –≤ Supabase, –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–µ–∑–¥–µ, –≥–¥–µ —Ä–∞–Ω—å—à–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è —Ç–æ–ª—å–∫–æ ID: –≤ —Å–ø–∏—Å–∫–µ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π, –≤ SOS-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö, –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ.

–ê—É–¥–∏—Ç–æ—Ä–∏—è: –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–∏ SOS (–≤–∏–¥—è—Ç —Å–≤–æ—ë –∏–º—è), —Ç–∞–∫ –∏ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–∏ (–≤–∏–¥—è—Ç –∏–º—è —á–µ–ª–æ–≤–µ–∫–∞ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ –∏ –≤ —Å–ø–∏—Å–∫–µ).

---

## 2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (Functional Requirements)

### UserService ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**FR-01.** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –∏–º–µ–Ω–∏, –≤–æ–∑–≤—Ä–∞—â–∞—é—â—É—é `true`, –µ—Å–ª–∏ –∫–ª—é—á `user_name` –≤ SharedPreferences –Ω–µ–ø—É—Å—Ç, –∏ `false` –∏–Ω–∞—á–µ.

**FR-02.** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –∏–∑ SharedPreferences (–∫–ª—é—á `user_name`), –≤–æ–∑–≤—Ä–∞—â–∞—é—â—É—é —Å—Ç—Ä–æ–∫—É –∏–ª–∏ `null`, –µ—Å–ª–∏ –∏–º—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.

**FR-03.** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏, –∫–æ—Ç–æ—Ä–∞—è:
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–º—è –≤ SharedPreferences –ø–æ –∫–ª—é—á—É `user_name`.
- –í—ã–ø–æ–ª–Ω—è–µ—Ç upsert –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Supabase: –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫—É `user_name` –≤ —Ç–∞–±–ª–∏—Ü–µ `users` –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ `user_id`.

### WelcomeScreen ‚Äî —ç–∫—Ä–∞–Ω –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

**FR-04.** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —ç–∫—Ä–∞–Ω `WelcomeScreen` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ–≥–¥–∞ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.

**FR-05.** `WelcomeScreen` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –∏ –∫–Ω–æ–ø–∫—É "Continue". –ö–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞, –ø–æ–∫–∞ `name.trim()` –ø—É—Å—Ç–æ–µ.

**FR-06.** –ü–æ –Ω–∞–∂–∞—Ç–∏—é "Continue" —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–º—è —á–µ—Ä–µ–∑ `UserService` –∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ `MainScreen`. –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥ –Ω–∞ `WelcomeScreen` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.

### –†–æ—É—Ç–∏–Ω–≥ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

**FR-07.** –ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ (`main.dart`) —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏–º–µ–Ω–∏ (FR-01) –∏ –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –ò–º—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí `WelcomeScreen`.
- –ò–º—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí `MainScreen`.

### GuardiansService ‚Äî –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**FR-08.** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Å–µ—Ä–≤–∏—Å `GuardiansService` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `findUserName(String userId)`, –≤—ã–ø–æ–ª–Ω—è—é—â–µ–π –∑–∞–ø—Ä–æ—Å `SELECT user_name FROM users WHERE user_id = '<ID>'` –≤ Supabase. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Å –∏–º–µ–Ω–µ–º –∏–ª–∏ `null`, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏–º—è –ø—É—Å—Ç–æ –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.

### GuardiansScreen ‚Äî —É–ª—É—á—à–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π

**FR-09.** –ü—Ä–∏ –≤–≤–æ–¥–µ ID —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ `GuardiansService` —Å debounce 500 –º—Å –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—è. –ü–æ–∫–∞ –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥ –ø–æ–ª–µ–º. –ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ø–æ–ª—è (–∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—É—Å—Ç—ã–º) ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞; –∑–∞–ø—Ä–æ—Å –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å.

**FR-10.** –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –≤–µ—Ä–Ω—É–ª –∏–º—è ‚Üí –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –ø–æ–¥ –ø–æ–ª–µ–º: `‚úì Found: [–ò–º—è]`.

**FR-11.** –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –Ω–µ –≤–µ—Ä–Ω—É–ª –∏–º–µ–Ω–∏ (–Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏) ‚Üí –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å: `‚ö†Ô∏è User not found`.

**FR-12.** `GuardiansScreen` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ "Nickname" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è ‚Äî –ª–∏—á–Ω—ã–π –ø—Å–µ–≤–¥–æ–Ω–∏–º, –≤–∏–¥–∏–º—ã–π —Ç–æ–ª—å–∫–æ —Å–∞–º–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

**FR-13.** –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ SharedPreferences: ID –ø–æ –∫–ª—é—á—É `guardian1`...`guardian5` –∏ nickname –ø–æ –∫–ª—é—á—É `guardian1_nickname`...`guardian5_nickname` (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω).

### –°–ø–∏—Å–æ–∫ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∏–º–µ–Ω–∞–º–∏

**FR-14.** –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –∏–º–µ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö guardian ID —á–µ—Ä–µ–∑ `GuardiansService`.

**FR-15.** –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–µ—Ç–∏; –ø—Ä–∏ –µ—ë –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ ‚Äî FR-16):
- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–æ–∫–∞: `[–ò–º—è] ([Nickname])` ‚Äî –µ—Å–ª–∏ Supabase –≤–µ—Ä–Ω—É–ª –∏–º—è –∏ Nickname –∑–∞–¥–∞–Ω; `[–ò–º—è]` ‚Äî –µ—Å–ª–∏ Supabase –≤–µ—Ä–Ω—É–ª –∏–º—è, Nickname –Ω–µ –∑–∞–¥–∞–Ω; `[Nickname]` ‚Äî –µ—Å–ª–∏ Supabase –≤–µ—Ä–Ω—É–ª `null` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –∏–º—è –Ω–µ –∑–∞–¥–∞–Ω–æ) –∏ Nickname –∑–∞–¥–∞–Ω; `[User ID]` ‚Äî –µ—Å–ª–∏ Supabase –≤–µ—Ä–Ω—É–ª `null` –∏ Nickname –Ω–µ –∑–∞–¥–∞–Ω.
- –ü–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –º–µ–ª–∫–∏–º —à—Ä–∏—Ñ—Ç–æ–º: User ID.

**FR-16.** –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∫ Supabase –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –æ—à–∏–±–∫–æ–π (–Ω–µ—Ç —Å–µ—Ç–∏, —Ç–∞–π–º–∞—É—Ç, –∏–Ω–∞—è –æ—à–∏–±–∫–∞), —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥–ª—è –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ–≥–æ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è —Ç–æ–ª—å–∫–æ User ID ‚Äî –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ Nickname.

### MainScreen ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–º–µ–Ω–∏

**FR-17.** –í –∫–∞—Ä—Ç–æ—á–∫–µ "My ID" —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–¥ ID (–µ—Å–ª–∏ –∏–º—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ).

**FR-18.** –ö–∞—Ä—Ç–æ—á–∫–∞ "My ID" –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "Edit Name".

**FR-19.** –ü–æ –Ω–∞–∂–∞—Ç–∏—é "Edit Name" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º –ø–æ–ª–µ–º, –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º —Ç–µ–∫—É—â–∏–º –∏–º–µ–Ω–µ–º. –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ –¥–∏–∞–ª–æ–≥–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞, –ø–æ–∫–∞ `name.trim()` –ø—É—Å—Ç–æ–µ (—Ç–µ –∂–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, —á—Ç–æ –∏ –≤ FR-05). –ü–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é ‚Äî –∏–º—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `UserService` –∏ –∫–∞—Ä—Ç–æ—á–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞. –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞" –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.

### SOSService ‚Äî –∏–º—è –≤ SOS-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏

**FR-20.** –ü—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ SOS —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∞—Ç—å –∏–º—è —á–µ—Ä–µ–∑ `UserService` –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ Edge Function –ø–æ–ª–µ `message`:
- –ï—Å–ª–∏ –∏–º—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: `SOS Emergency from [–ò–º—è] ([ID])`.
- –ï—Å–ª–∏ –∏–º–µ–Ω–∏ –Ω–µ—Ç: `SOS Emergency from [ID]`.

---

## 3. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (Non-Functional Requirements)

**NFR-01.** Debounce –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è ‚Äî —Ä–æ–≤–Ω–æ 500 –º—Å.

**NFR-02.** –ó–∞–ø—Ä–æ—Å `GuardiansService.findUserName()` –¥–æ–ª–∂–µ–Ω –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –Ω–µ –±–æ–ª–µ–µ —á–µ–º –∑–∞ 5 —Å–µ–∫—É–Ω–¥; –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `null`. *(–ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ)*

**NFR-03.** –í—Å–µ –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ UI –≤—ã–Ω–æ—Å—è—Ç—Å—è –≤ ARB-—Ñ–∞–π–ª—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é ru/en/zh.

**NFR-04.** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –∞–≤–∞—Ä–∏–π–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –ø—Ä–∏ –ª—é–±—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö –≤–æ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∏–º–µ–Ω–∞–º–∏.

**NFR-05.** –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ 50 —Å–∏–º–≤–æ–ª–∞–º–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ UI. *(–ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ)*

**NFR-06.** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –≤ SharedPreferences –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Supabase. *(–ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ)*

**NFR-07.** –ó–∞–ø—Ä–æ—Å—ã –∫ Supabase –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º—ë–Ω —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (`Future.wait`), –∞ –Ω–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ. *(–ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ)*

**NFR-08.** –ö–æ–ª–æ–Ω–∫–∞ `user_name` (—Ç–∏–ø TEXT, nullable) –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ `users` Supabase –¥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥—É—Å–ª–æ–≤–∏–µ–º. *(–ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ)*

---

## 4. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ (Acceptance Criteria)

**AC-01 (‚Üí FR-04, FR-07)**
- *Given:* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤–ø–µ—Ä–≤—ã–µ, SharedPreferences –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç `user_name`.
- *When:* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.
- *Then:* –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è `WelcomeScreen` —Å –ø—É—Å—Ç—ã–º –ø–æ–ª–µ–º –∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π "Continue".

**AC-02 (‚Üí FR-05, FR-06)**
- *Given:* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ `WelcomeScreen` –≤–≤—ë–ª –∏–º—è "Alice".
- *When:* –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "Continue".
- *Then:* `user_name` = "Alice" –≤ SharedPreferences –∏ –≤ Supabase; –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è `MainScreen`; –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ `WelcomeScreen`.

**AC-03 (‚Üí FR-07)**
- *Given:* –í SharedPreferences –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç `user_name` = "Alice".
- *When:* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è.
- *Then:* –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è `MainScreen`, `WelcomeScreen` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è.

**AC-04 (‚Üí FR-17, FR-18)**
- *Given:* `MainScreen` –æ—Ç–∫—Ä—ã—Ç, `user_name` = "Alice".
- *When:* –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ "My ID".
- *Then:* –ù–∞–¥ ID –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "Alice"; –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–Ω–æ–ø–∫–∞ "Edit Name".

**AC-05 (‚Üí FR-19)**
- *Given:* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "Edit Name".
- *When:* –î–∏–∞–ª–æ–≥ –æ—Ç–∫—Ä—ã–ª—Å—è.
- *Then:* –ü–æ–ª–µ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Ç–µ–∫—É—â–∏–º –∏–º–µ–Ω–µ–º "Alice".

**AC-06 (‚Üí FR-19)**
- *Given:* –î–∏–∞–ª–æ–≥ –æ—Ç–∫—Ä—ã—Ç, –≤–≤–µ–¥–µ–Ω–æ –Ω–æ–≤–æ–µ –∏–º—è "Bob", –Ω–∞–∂–∞—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.
- *When:* –î–∏–∞–ª–æ–≥ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è.
- *Then:* –ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Bob"; SharedPreferences —Å–æ–¥–µ—Ä–∂–∏—Ç `user_name` = "Bob"; Supabase –æ–±–Ω–æ–≤–ª—ë–Ω.

**AC-07 (‚Üí FR-09, FR-10)**
- *Given:* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π –≤–≤–æ–¥–∏—Ç ID "ABCD1234" (—Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ Supabase —Å –∏–º–µ–Ω–µ–º "Charlie").
- *When:* –ü—Ä–æ—à–ª–æ 500 –º—Å –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞–∂–∞—Ç–∏—è.
- *Then:* –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è `‚úì Found: Charlie`.

**AC-08 (‚Üí FR-09, FR-11)**
- *Given:* –í–≤–µ–¥—ë–Ω ID "ZZZZZZZZ" (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ Supabase).
- *When:* –ü–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à—ë–Ω.
- *Then:* –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è `‚ö†Ô∏è User not found`.

**AC-09 (‚Üí FR-12, FR-13)**
- *Given:* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª ID "ABCD1234" –∏ Nickname "Mom".
- *When:* –ù–∞–∂–∞—Ç–æ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å".
- *Then:* SharedPreferences: `guardian1` = "ABCD1234", `guardian1_nickname` = "Mom".

**AC-10 (‚Üí FR-13)**
- *Given:* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª ID –±–µ–∑ Nickname.
- *When:* –ù–∞–∂–∞—Ç–æ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å".
- *Then:* SharedPreferences: `guardian1_nickname` = "" (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞).

**AC-11 (‚Üí FR-14, FR-15)**
- *Given:* –°–æ—Ö—Ä–∞–Ω—ë–Ω —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å ID "ABCD1234" (Supabase: –∏–º—è "Charlie"), Nickname "Mom".
- *When:* –°–ø–∏—Å–æ–∫ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–µ—Ç–∏.
- *Then:* –ü–æ–∑–∏—Ü–∏—è: –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç "Charlie (Mom)", –º–µ–ª–∫–∏–º —à—Ä–∏—Ñ—Ç–æ–º "ABCD1234".

**AC-12 (‚Üí FR-15)**
- *Given:* –•—Ä–∞–Ω–∏—Ç–µ–ª—å "ABCD1234" (–∏–º—è "Charlie"), Nickname –Ω–µ –∑–∞–¥–∞–Ω.
- *When:* –°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è.
- *Then:* –ü–æ–∑–∏—Ü–∏—è: –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç "Charlie", –º–µ–ª–∫–∏–º —à—Ä–∏—Ñ—Ç–æ–º "ABCD1234".

**AC-13 (‚Üí FR-16)**
- *Given:* –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ç–∏; —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å ID "ABCD1234" –∏–º–µ–µ—Ç Nickname "Mom" –≤ SharedPreferences.
- *When:* –°–ø–∏—Å–æ–∫ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è.
- *Then:* –•—Ä–∞–Ω–∏—Ç–µ–ª—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ "ABCD1234" (Nickname "Mom" –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è); –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∞–≤–∞—Ä–∏–π–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.

**AC-14 (‚Üí FR-20)**
- *Given:* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "Alice" (ID "XY123456") –Ω–∞–∂–∏–º–∞–µ—Ç SOS.
- *When:* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è.
- *Then:* –í Edge Function –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è `message: "SOS Emergency from Alice (XY123456)"`.

**AC-15 (‚Üí FR-20)**
- *Given:* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –∏–º–µ–Ω–∏ (ID "XY123456") –Ω–∞–∂–∏–º–∞–µ—Ç SOS.
- *When:* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è.
- *Then:* –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è `message: "SOS Emergency from XY123456"`.

**AC-16 (‚Üí FR-05)**
- *Given:* –ü–æ–ª–µ –∏–º–µ–Ω–∏ –ø—É—Å—Ç–æ–µ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–µ–ª—ã.
- *When:* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É "Continue".
- *Then:* –ö–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ (disabled).

**AC-17 (‚Üí FR-09)**
- *Given:* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª ID "ABCD1234" –≤ –ø–æ–ª–µ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è, –∑–∞—Ç–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç—ë—Ä –µ–≥–æ.
- *When:* –ü–æ–ª–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—É—Å—Ç—ã–º.
- *Then:* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–æ–∏—Å–∫–∞ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è; –∑–∞–ø—Ä–æ—Å –∫ Supabase –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.

**AC-18 (‚Üí FR-19)**
- *Given:* –û—Ç–∫—Ä—ã—Ç –¥–∏–∞–ª–æ–≥ "Edit Name", –ø–æ–ª–µ –æ—á–∏—â–µ–Ω–æ (–ø—É—Å—Ç–æ–µ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–µ–ª—ã).
- *When:* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.
- *Then:* –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ (disabled); —Ç–µ–∫—É—â–µ–µ –∏–º—è –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞.

---

## 5. –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ (Edge Cases)

**EC-01. –ò–º—è –∏–∑ –æ–¥–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤.** –í–≤–æ–¥ " " –¥–æ–ª–∂–µ–Ω —Å—á–∏—Ç–∞—Ç—å—Å—è –ø—É—Å—Ç—ã–º –ø–æ—Å–ª–µ `trim()`; –∫–Ω–æ–ø–∫–∏ "Continue" –∏ "Save" –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º–∏.

**EC-02. –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –∏–º–µ–Ω–∏.** –ü–æ–ª–µ –≤–≤–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ 50 —Å–∏–º–≤–æ–ª–∞–º–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ UI (`maxLength`), —á—Ç–æ–±—ã –Ω–µ –¥–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ–ø–∞–¥–∞–Ω–∏—è –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –≤ –ë–î.

**EC-03. –°–±–æ–π Supabase –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–º–µ–Ω–∏.** –ò–º—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ SharedPreferences. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∫ Supabase —É–ø–∞–ª ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è Snackbar-–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ `MainScreen`. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –¥–∞–Ω–Ω–æ–º —Ä–µ–ª–∏–∑–µ –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è.

**EC-04. –ü–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è debounce-–∑–∞–ø—Ä–æ—Å—ã.** –ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –≤–≤–æ–¥–µ —Å–∏–º–≤–æ–ª–æ–≤ debounce —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è. –ï—Å–ª–∏ —Å–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, –µ–≥–æ –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ (race condition).

**EC-05. –ù–µ–ø–æ–ª–Ω—ã–π ID —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è (< 8 —Å–∏–º–≤–æ–ª–æ–≤).** Debounce –≤—Å—ë —Ä–∞–≤–Ω–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç; Supabase –≤–µ—Ä–Ω—ë—Ç `null`; –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è `‚ö†Ô∏è User not found`. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã ID ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤–Ω–µ SPEC.

**EC-06. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π ID –≤ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–∏.** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –¥–æ–ø—É—Å—Ç–∏–º–æ ‚Äî –ø–æ–∏—Å–∫ –≤–µ—Ä–Ω—ë—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–º—è. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —ç—Ç–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏.

**EC-07. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π.** –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–∫—É `guardian1`...`guardian5` –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—á–µ—Ä—ë–¥–Ω–æ—Å—Ç–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `Future.wait`).

**EC-08. –ö–æ–ª–æ–Ω–∫–∞ `user_name` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ Supabase (–Ω–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏).** –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è –æ—à–∏–±–∫–æ–π. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ; –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π UI (—Ç–æ–ª—å–∫–æ ID). –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –º–∏–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–æ —Ä–µ–ª–∏–∑–∞.

**EC-09. –ù–∏–∫–Ω–µ–π–º —Å–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏.** –ó–Ω–∞—á–µ–Ω–∏—è —Ç–∏–ø–∞ "–ú–∞–º–∞", "O'Brien", "üòä" –¥–æ–ª–∂–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ SharedPreferences –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

**EC-10. –°–º–µ–Ω–∞ —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.** –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî —Å—Ç—Ä–æ–∫–∞, –≤–≤–µ–¥—ë–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ª–æ–∫–∞–ª–∏. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç –∏ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏–º—è.

**EC-11. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —É—Å—Ç–∞–Ω–æ–≤–∏–≤—à–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ –≤–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏–º—ë–Ω, –∏–º–µ–µ—Ç `user_id` –∏ `onesignal_id` –≤ Supabase, –Ω–æ `user_name` –≤ SharedPreferences –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å `WelcomeScreen` –∏ –æ–±—è–∑–∞–Ω –≤–≤–µ—Å—Ç–∏ –∏–º—è ‚Äî –∫–∞–∫ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

**EC-12. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –∏–º–µ–Ω–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–º.** –ï—Å–ª–∏ legacy-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è) –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ Supabase, –Ω–æ –∫–æ–ª–æ–Ω–∫–∞ `user_name` –¥–ª—è –Ω–µ–≥–æ NULL, —Ñ—É–Ω–∫—Ü–∏—è `findUserName` –≤–µ—Ä–Ω—ë—Ç `null`. –î–æ–±–∞–≤–ª—è—é—â–∏–π –µ–≥–æ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç `‚ö†Ô∏è User not found`. –≠—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ legacy-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–æ–π–¥—ë—Ç WelcomeScreen –∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –∏–º—è.

---

## 6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –¥–æ–ø—É—â–µ–Ω–∏—è (Constraints & Assumptions)

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **C-01.** Backend ‚Äî Supabase (anon key, –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π).
- **C-02.** –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ ‚Äî SharedPreferences. –ö–ª—é—á–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã: `user_name`, `guardian1_nickname`...`guardian5_nickname`.
- **C-03.** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π ‚Äî 5 (—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ).
- **C-04.** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º—ë–Ω —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π (–∏–∑ Supabase) –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ –¥–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏. –ü—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö –≤ —Å–ø–∏—Å–∫–µ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ User ID, –¥–∞–∂–µ –µ—Å–ª–∏ Nickname —Å–æ—Ö—Ä–∞–Ω—ë–Ω –ª–æ–∫–∞–ª—å–Ω–æ.
- **C-05.** –¢–∞–±–ª–∏—Ü–∞ `users` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–æ–π `user_name TEXT NULL` –¥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è Flutter-–∏–∑–º–µ–Ω–µ–Ω–∏–π. –ú–∏–≥—Ä–∞—Ü–∏—è ‚Äî –ø—Ä–µ–¥—É—Å–ª–æ–≤–∏–µ, –Ω–µ –≤—Ö–æ–¥—è—â–µ–µ –≤ –∑–∞–¥–∞—á—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
- **C-06.** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ª–æ–∫–∞–ª–∏: ru, en, zh. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞.

### –î–æ–ø—É—â–µ–Ω–∏—è

- **–î–æ–ø—É—â–µ–Ω–∏–µ:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∏–º–µ–Ω–∏ ‚Äî 50 —Å–∏–º–≤–æ–ª–æ–≤. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ UI.
- **–î–æ–ø—É—â–µ–Ω–∏–µ:** `UserService.saveUserName` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç upsert –≤ Supabase, –∞ –Ω–µ —á–∏—Å—Ç—ã–π UPDATE, –ø–æ—Å–∫–æ–ª—å–∫—É –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ OneSignal-ID.
- **–î–æ–ø—É—â–µ–Ω–∏–µ:** –ü—Ä–∏ —Å–±–æ–µ Supabase –≤–æ –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–π Snackbar, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `MainScreen`.
- **–î–æ–ø—É—â–µ–Ω–∏–µ:** –ü–æ–ª–∏—Ç–∏–∫–∏ RLS –≤ Supabase —Ä–∞–∑—Ä–µ—à–∞—é—Ç SELECT –ø–æ –ø–æ–ª—è–º `user_id` –∏ `user_name` –¥–ª—è anon-—Ç–æ–∫–µ–Ω–∞. –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–∞–∫ ‚Äî –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ RLS.
- **–î–æ–ø—É—â–µ–Ω–∏–µ:** –î–∏–∞–ª–æ–≥ "Edit Name" ‚Äî –º–æ–¥–∞–ª—å–Ω—ã–π (`showDialog`), –∞ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç/—ç–∫—Ä–∞–Ω.
- **–î–æ–ø—É—â–µ–Ω–∏–µ:** `GuardiansScreen` ‚Äî –¥–æ—Ä–∞–±–æ—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ `EmergencyNumberScreen` –≤ `settings_screen.dart`, –∞ –Ω–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª.
- **–î–æ–ø—É—â–µ–Ω–∏–µ:** `WelcomeScreen` –Ω–µ –∏–º–µ–µ—Ç –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" ‚Äî –≤–≤–æ–¥ –∏–º–µ–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.
